# win内存泄露windbg


```shell
# 查看堆统计信息
0:000> !heap -s


************************************************************************************************************************
                                              NT HEAP STATS BELOW
************************************************************************************************************************
LFH Key                   : 0xc029131e
Termination on corruption : DISABLED
  Heap     Flags   Reserv  Commit  Virt   Free  List   UCR  Virt  Lock  Fast 
                    (k)     (k)    (k)     (k) length      blocks cont. heap 
-----------------------------------------------------------------------------
00d40000 00000002   78796  62424  78584   4750  1123    74    2     5a   LFH
00d10000 00001002    1292    404   1080     26    22     2    0      0   LFH
028a0000 00001002  750640 749024 750428   1574  2353   249    6   565c   LFH
04260000 00001002      60     20     60      5     1     1    0      0      
08ab0000 00001002    1292    532   1080    115    14     2    0      0   LFH
0df60000 00001002      60      8     60      3     1     1    0      0      
20e30000 00001002    1292    536   1080    219     9     2    0      0   LFH
258e0000 00001002    1292    108   1080     31     9     2    0      4   LFH
22460000 00001002    1292    132   1080     43     9     2    0      0   LFH
25490000 00001002     272     64     60     20     8     1    0     25   LFH
-----------------------------------------------------------------------------

# 查看某个堆的统计分布
0:000> !heap -stat -h 028a0000 
 heap @ 028a0000
group-by: TOTSIZE max-display: 20
    size     #blocks     total     ( %) (percent of total busy bytes)
    40000 1 - 40000  (18.15)
    44 a95 - 2cf94  (12.75)
    50 358 - 10b80  (4.74)
    f000 1 - f000  (4.25)
    1000 d - d000  (3.69)
    30 455 - cff0  (3.68)
    18 87a - cb70  (3.60)
    24 568 - c2a0  (3.45)
    6004 2 - c008  (3.40)
    2c 3d4 - a870  (2.98)
    80 120 - 9000  (2.55)
    cc b1 - 8d0c  (2.50)
    a0 c9 - 7da0  (2.23)
    300 20 - 6000  (1.70)
    14 496 - 5bb8  (1.63)
    220 29 - 5720  (1.54)
    214 26 - 4ef8  (1.40)
    3c 12a - 45d8  (1.24)
    10 437 - 4370  (1.19)
    4020 1 - 4020  (1.14)

0:000> !heap -flt s 40000 
    _HEAP @ d40000
    _HEAP @ d10000
    _HEAP @ 28a0000
      HEAP_ENTRY Size Prev Flags    UserPtr UserSize - state
        029d1b78 8001 0000  [00]   029d1b80    40000 - (busy)

```