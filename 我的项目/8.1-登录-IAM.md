# IAM登录

## IAM场景
在介绍IAM是什么之前，请先回想一下你是否遇到过这些场景。
1. 作为员工/用户
* 多套账号密码：在CRM中是老杨/密码1234，在OA中是小杨/密码9527，由于账号过多，经常忘记账号、密码，或者干脆设置同样的或简单的密码。
* 反复注册登录：在不同系统/APP中需要反复地输入账号密码登录，或者反复注册、申请审批。

2. 作为企业管理员
* 管理员工的账号/权限费时费力：无法统一管理员工在公司内不同系统的账号/权限，导致员工缺少账号或拥有过多账号/权限；员工入职、转岗、离职时需要手动开通/收回员工的账号。
* 无法追踪员工的行为：员工的活动分散在企业内各个系统中，无法及时发现、统计员工的行为轨迹，制止风险行为。

3. 作为开发者
* 反复造轮子：针对账号体系、注册登录、第三方登录、用户自主服务等常规和基础的功能需要反复开发。
* 用户数据难打通：即使在公司内部，也容易出现不同系统之间账号体系的设计、口径不一致的情况，导致系统之间的用户数据难以打通。

IAM可以很好地解决上述的问题，举个例子：

老王入职新公司，用企业微信扫码加入公司，填写相关资料，加入了后端组。

老王打开电脑，输入应用门户的地址，使用账号密码或扫码登录，在工作台中就可以看到阿里云、企业微信、Gitlab、禅道、OA等各种平时需要用到的应用。

点击应用图标即可自动登录进入应用，使用已被自动授权的功能。

管理人员可以在管理后台统计员工的登录情况、使用情况。

## IAM定义
IAM是 Identity and Access Management 的缩写，即身份与访问管理，或称为身份管理与访问控制。

IAM主要为了达到一个目的：让恰当的人或物，有恰当的权限，访问恰当的资源。其中“人或物”称为主体（Subject），“资源”称为客体（Object）。

传统的IAM一般包含如下几部分，常被称为“4A”或“5A”。
* 账号（Account）
* 认证（Authentication）
* 权限（Authorization）
* 应用（Application）
* 审计（Audit）

从使用场景上划分，IAM主要有有三大类。
1. EIAM
EIAM是 Employee Identity and Access Management 的缩写，指管理企业内部员工的IAM，主要解决员工使用的便捷性和企业管理的安全性相关问题。

在产品形态上，EIAM有以下特点：
* 需要集成企业的云应用、本地应用
* 需要集成不同的身份源
* SSO和MFA很常用
* 不同企业所需的访问控制力度不同

2. CIAM
CIAM是 Customer Identity and Access Management 的缩写，指管理企业外部客户/用户的IAM，主要解决用户数据的打通和开发成本与标准化相关问题。

在产品形态上，CIAM有以下特点：
* 在用户端常见到的是单点登录和授权登录
* 提供通用的组件给开发者直接使用
* 更强调高性能和高可用

3. 云厂商IAM
云厂商的IAM，有时称为RAM（Resource and Access Management），指管理企业云资源的IAM，主要用于管理云资源的访问控制。

在产品形态上，云厂商IAM有以下特点：
* 强调授权的灵活性和企业管理的安全性
* 支持多种类型的账号进行认证或被调用
* 一般只关注管理自家的云资源
* 本文主要以较常见的EIAM为例来介绍IAM。

本文主要以较常见的EIAM为例来介绍IAM。

## 账号（Account）
账号是用户在系统中的数字化载体，用于标识用户并访问受保护的资源。一般每个系统都会有账号，且不同系统的账号数据结构各异。

针对账号模块，IAM需要解决如下几个问题：

* 哪些账号/字段代表了用户？这些账号散落在哪里？（身份源）
* 我（IAM）如何将这些账号拿过来？（上游账号同步）
* 我（IAM）如何关联、映射、使用这些账号数据？（统一身份源）
* 哪些系统需要用到这些账号？我怎么把账号给它们？（下游账号同步）

账号模块一般会包含如下子模块和协议。
1. 子模块
* 账号管理：包括账号的增删改查、启用禁用、重置密码、解锁账号等。
* 组织/用户组管理：用于将用户和权限关联起来，减少分配权限的操作。
* 账号生命周期管理：管理员工的入职、升职、调岗、离职等整个生命周期。
* 身份源集成同步：从上游应用中获取账号数据，将账号、字段进行关联、映射和转换，作为用户唯一标准的数据同步给下游应用。

2. 协议
* AD/LDAP：LDAP（Lightweight Directory Access Protocol，轻型目录访问协议），是一种用于维护树形目录信息和提供访问控制的协议，通常所说的AD/LDAP指的是Windows的AD和Linux的OpenLDAP，是一种树形的数据库，在企业内部常被用于管理用户数据和用户认证。
* SCIM：SCIM（System for Cross-domain Identity Management，跨域身份管理），是一种简化同步和管理身份数据的协议，常用于公有云应用。

# 认证（Authentication）
广义的认证是一种信用保证形式，指第三方公证机构对组织/个人的身份、能力、资质等的认可。

狭义的认证指的是证明“主体是谁”。IAM中的认证指的是狭义的认证，常见于主体申请访问资源时。

1. 认证场景
IAM中有三个主要的场景：
* 未认证的主体需要认证——登录
* 已认证的主体跳转到其他应用时自动认证——SSO，单点登录
* 已认证的主体访问敏感资源时需要二次认证——MFA，多因素认证

2. 认证协议
认证协议主要用于在用户、业务系统、身份认证服务之间传递用户信息，告诉业务系统“此用户是谁”。

主流的认证协议/实现单点登录的方案有Cookie、JWT、SAML、CAS、OIDC等，网上有很多资料，暂不赘述。

认证协议通常和单点登录息息相关，单点登录（Single Sign On，SSO）是指在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统。

3. 认证源
认证源指的是用户在登录当前系统时，由第三方提供认证服务，系统信任第三方的认证结果。例如使用微信登录某APP，就是将微信作为认证源。

IAM一般会根据场景提供AD/LDAP、企业微信/钉钉、OA等不同的认证源方案。